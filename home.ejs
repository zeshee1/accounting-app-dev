<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home | Saddiqi Brothers</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
             background-image: url('img/bg.jpg');
             background-size: cover;
             background-repeat: no-repeat;
             background-position: center center;
        }
        .sidebar {
            background-color: #343a40;
            color: white;
            padding-top: 20px;
            width: 250px;
            min-width: 250px;
            transition: width 0.3s ease;
        }
        .sidebar-title {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 1.2em;
            font-weight: bold;
        }
        .sidebar a {
            padding: 12px 20px;
            display: block;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }
        .sidebar a:hover {
            background-color: #495057;
        }
        .sidebar a i {
            margin-right: 10px;
        }
        .content {
            flex-grow: 1;
            padding: 30px;
        }
        .header-actions {
            margin-bottom: 25px;
        }
        .dashboard-card {
            border: none;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }
        .dashboard-card .card-body {
            padding: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .dashboard-card .card-title {
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        .dashboard-card .amount {
            font-size: 1.7em;
            font-weight: bold;
        }
        .chart-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 25px;
        }
        .chart-container h5 {
            margin-bottom: 15px;
            font-size: 1.2em;
            color: #333;
        }
        .opening-cash-form {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            padding: 30px;
        }
        .opening-cash-form h5 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2em;
            color: #333;
        }
        .opening-cash-form .form-control {
            margin-bottom: 20px;
        }
        .opening-cash-form .btn-success {
            width: 100%;
        }

        /* Calculator Styles (ye style.css mein hona chahiye) */
        .calculator {
            /* width: 300px; */
            max-width: 300px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
            background-color: #f0f0f0;
        }

        .calculator #display {
            width: 100%;
            padding: 15px;
            font-size: 24px;
            text-align: right;
            border: none;
            background-color: #e0e0e0;
            box-sizing: border-box;
        }

        .calculator .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
        }

        .calculator .buttons button {
            padding: 15px;
            font-size: 20px;
            border: none;
            background-color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .calculator .buttons button:hover {
            background-color: #ddd;
        }

        .calculator .buttons .equal {
            grid-column: span 1;
            background-color: #007bff;
            color: white;
        }

        .calculator .buttons .equal:hover {
            background-color: #0056b3;
        }

        /* Style for the container of the pie chart and calculator */
        .expenses-calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Divide the space into two equal columns */
            gap: 20px; /* Add some space between them */
        }

        /* Adjust the Expenses Breakdown chart container */
        .expenses-calculator-container .chart-container {
            margin-bottom: 20; /* Remove the default bottom margin */
        }
        
    </style>
   
</head>
<body>

    <div class="sidebar">
        <h3 class="sidebar-title"><i class="fas fa-tachometer-alt mr-2"></i> Menu</h3>
        <a href="/" class="active"><i class="fas fa-home"></i> Home</a>
        <a href="/report/product-wise-revenue" class="btn">ðŸ“Š Product-wise Revenue</a>
        <a href="/all-purchases" class="btn btn-primary">All Purchases</a> 
        <a href="/purchase"><i class="fas fa-truck"></i> Add Purchase</a>
        <a href="/invoice"><i class="fas fa-file-invoice"></i> Create Invoice</a>
        <a href="/invoice/all"><i class="fas fa-list-alt"></i> View All Invoices</a>
        <a href="/expense"><i class="fas fa-coins"></i> Add Expense</a>
        <a href="/expense/all"><i class="fas fa-list-ul"></i> View Expenses</a>
        <a href="/salary" class=""><i class="fas fa-user-tie"></i> Salary Management</a>
        <a href="/summary-form"><i class="fas fa-calendar-day"></i> Daily Summary</a>
        <a href="/customers"><i class="fas fa-users"></i> Customer Details</a>
        <a href="/salary-report"><i class="fas fa-chart-line"></i> Salary Report</a>
    </div>

    <div class="content">
        <div class="header-actions">
            <a href="/invoice" class="btn btn-primary btn-sm"><i class="fas fa-plus mr-2"></i> Add Sale</button></a>
            <a href="/purchase" class="btn btn-primary btn-sm"><i class="fas fa-plus mr-2"></i> Purchase</button></a>
            <a href="/salary" class="btn btn-primary btn-sm"><i class="fas fa-money-bill-wave mr-2"></i> Salary</a>
            <a href="/summary-form" class="btn btn-primary btn-sm"><i class="fas fa-plus mr-2"></i> Summary</button></a>
            <a href="/expense" class="btn btn-primary btn-sm"><i class="fas fa-plus mr-2"></i> Expense</button></a>
            <img src="/img/Logo.gif" alt="Company Logo" style="height: 95px; width: 372px; margin-left: 900px;">

        </div>
        <h1 class="text-center mb-4">Saddiqui Brothers Accounting Software</h1>

        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <div class="card dashboard-card bg-info text-white">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-chart-line mr-2"></i> Total Sales</h5>
                        <p class="card-text amount">Rs. <%= totalSales.toLocaleString() %></p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card dashboard-card bg-danger text-white">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-chart-bar mr-2"></i> Total Expenses</h5>
                        <p class="card-text amount">Rs. <%= totalExpenses.toLocaleString() %></p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card dashboard-card bg-warning text-dark">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-chart-pie mr-2"></i> Cash In Hand</h5>
                        <p class="card-text amount">Rs. <%= (totalSales - totalExpenses).toLocaleString() %></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="chart-container">
                    <h5 class="card-title"><i class="fas fa-chart-line mr-2"></i> Sales Trend (Monthly)</h5>
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h5 class="card-title"><i class="fas fa-chart-bar mr-2"></i> Expenses Trend (Monthly)</h5>
                    <canvas id="expensesTrendChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="expenses-calculator-container">
                    <div class="chart-container">
                        <h5 class="card-title"><i class="fas fa-chart-pie mr-2"></i> Expenses Breakdown (This Month)</h5>
                        <canvas id="expensesChart"></canvas>
                    </div>
                    <div class="calculator">
                        <input type="text" id="display" disabled>
                        <div class="buttons">
                            <button onclick="clearDisplay()">C</button>
                            <button onclick="deleteLast()">DEL</button>
                            <button onclick="appendOperator('/')">/</button>
                            <button onclick="appendOperator('*')">*</button>

                            <button onclick="appendNumber('7')">7</button>
                            <button onclick="appendNumber('8')">8</button>
                            <button onclick="appendNumber('9')">9</button>
                            <button onclick="appendOperator('-')">-</button>

                            <button onclick="appendNumber('4')">4</button>
                            <button onclick="appendNumber('5')">5</button>
                            <button onclick="appendNumber('6')">6</button>
                            <button onclick="appendOperator('+')">+</button>

                            <button onclick="appendNumber('1')">1</button>
                            <button onclick="appendNumber('2')">2</button>
                            <button onclick="appendNumber('3')">3</button>
                            <button class="equal" onclick="calculate()">=</button>

                            <button onclick="appendNumber('0')">0</button>
                            <button onclick="appendNumber('.')">.</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            &copy; <%= new Date().getFullYear() %> Saddiqi Brothers. All Rights Reserved.
            
        </div>
    
    </div>
    </div>

    <script>
        let display = document.getElementById('display');
    let currentInput = '';
    let operator = null;
    let firstOperand = null;

    function appendNumber(number) {
        currentInput += number;
        display.value = currentInput;
    }

    function appendOperator(op) {
        if (currentInput === '') return;
        if (firstOperand !== null) {
            calculate();
        }
        firstOperand = parseFloat(currentInput);
        operator = op;
        currentInput = '';
    }

    function calculate() {
        if (operator === null || currentInput === '') return;
        let secondOperand = parseFloat(currentInput);
        let result;

        switch (operator) {
            case '+':
                result = firstOperand + secondOperand;
                break;
            case '-':
                result = firstOperand - secondOperand;
                break;
            case '*':
                result = firstOperand * secondOperand;
                break;
            case '/':
                if (secondOperand === 0) {
                    result = 'Error';
                } else {
                    result = firstOperand / secondOperand;
                }
                break;
            default:
                return;
        }

        currentInput = String(result);
        operator = null;
        firstOperand = null;
        display.value = currentInput;
    }

    function clearDisplay() {
        currentInput = '';
        operator = null;
        firstOperand = null;
        display.value = '';
    }

    function deleteLast() {
        currentInput = currentInput.slice(0, -1);
        display.value = currentInput;
    }

    const salesData = {
        labels: [],
        datasets: [{
            label: 'Total Sales',
            data: [],
            backgroundColor: 'rgba(54, 162, 235, 0.8)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            tension: 0.1
        }]
    };

    const expensesData = {
        labels: [],
        datasets: [{
            label: 'Expenses',
            data: [],
            backgroundColor: [
                'rgba(255, 99, 132, 0.8)',
                'rgba(54, 162, 235, 0.8)',
                'rgba(255, 206, 86, 0.8)',
                'rgba(75, 192, 192, 0.8)',
                'rgba(153, 102, 255, 0.8)',
                'rgba(255, 159, 64, 0.8)',
                'rgba(199, 21, 133, 0.8)',
                'rgba(0, 128, 0, 0.8)',
                'rgba(218, 165, 32, 0.8)',
                'rgba(0, 0, 255, 0.8)',
                'rgba(128, 0, 128, 0.8)',
                'rgba(0, 128, 128, 0.8)',
                'rgba(128, 128, 0, 0.8)'
            ],
            borderColor: 'rgba(255, 255, 255, 1)',
            borderWidth: 1
        }]
    };

    const expensesTrendData = {
        labels: [],
        datasets: [{
            label: 'Total Expenses',
            data: [],
            backgroundColor: 'rgba(255, 99, 132, 0.8)',
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 1,
            tension: 0.1
        }]
    };

    const salesChartCanvas = document.getElementById('salesChart').getContext('2d');
    const expensesChartCanvas = document.getElementById('expensesChart').getContext('2d');
    const expensesTrendChartCanvas = document.getElementById('expensesTrendChart').getContext('2d');

    const salesChart = new Chart(salesChartCanvas, {
        type: 'line', // Changed to line for trend
        data: salesData,
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Sales Amount (Rs)'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Month'
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom'
                },
                title: {
                    display: true,
                    text: 'Monthly Sales Trend',
                    font: {
                        size: 16
                    }
                }
            }
        }
    });

    const expensesChart = new Chart(expensesChartCanvas, {
        type: 'pie', // Keep pie for breakdown
        data: expensesData,
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom'
                },
                title: {
                    display: true,
                    text: 'Daily Expenses Breakdown',
                    font: {
                        size: 16
                    }
                }
            }
        }
    });

    const expensesTrendChart = new Chart(expensesTrendChartCanvas, {
        type: 'bar',
        data: expensesTrendData,
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Expenses Amount (Rs)'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Month'
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom'
                },
                title: {
                    display: true,
                    text: 'Monthly Expenses Trend',
                    font: {
                        size: 16
                    }
                }
            }
        }
    });

    function getMonthName(month) {
        const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
        ];
        return monthNames[month - 1];
    }

    fetch('/api/dashboard-data')
        .then(response => response.json())
        .then(data => {
            // Update Sales Chart
            salesChart.data.labels = data.salesLabels.map(label => {
                const parts = label.split('-');
                return `${getMonthName(parseInt(parts[1]))}-${parts[0].slice(-2)}`; // Format as Month-YY
            });
            salesChart.data.datasets[0].data = data.salesAmounts;
            salesChart.update();

            // Update Expenses Trend Chart
            expensesTrendChart.data.labels = data.monthlyExpenseLabels.map(label => {
                const parts = label.split('-');
                return `${getMonthName(parseInt(parts[1]))}-${parts[0].slice(-2)}`; // Format as Month-YY
            });
            expensesTrendChart.data.datasets[0].data = data.monthlyExpenseAmounts;
            expensesTrendChart.update();

            // Update Expenses Pie Chart
            expensesChart.data.labels = Object.keys(data.expenseBreakdown);
            expensesChart.data.datasets[0].data = Object.values(data.expenseBreakdown);
            expensesChart.update();
        })
        .catch(error => {
            console.error('Error fetching dashboard data:', error);
        });
</script>
    </script>

</body>
</html>